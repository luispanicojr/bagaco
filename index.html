<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>An√°lise de Consumo e Estoque de Baga√ßo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#111827"/>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #111827;
            color: #e5e7eb;
        }
        .card {
            background-color: #1f2937;
            border-radius: 0.75rem;
            border: 1px solid #374151;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.2), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            transition: all 0.3s ease-in-out;
        }
        .card:hover {
            border-color: #4b5563;
        }
        .result-card {
            background-color: #111827;
        }
        .slider {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 6px;
            background: #374151;
            border-radius: 3px;
            outline: none;
            transition: opacity .2s;
        }
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            background: #f59e0b;
            cursor: pointer;
            border-radius: 50%;
            border: 3px solid #1f2937;
        }
        .slider::-moz-range-thumb {
            width: 24px;
            height: 24px;
            background: #f59e0b;
            cursor: pointer;
            border-radius: 50%;
            border: 3px solid #1f2937;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 900px;
            margin-left: auto;
            margin-right: auto;
            height: 40vh;
            max-height: 450px;
        }
        input[type="number"] {
            background-color: #374151;
            border: 1px solid #4b5563;
            color: #e5e7eb;
        }
        input[type="number"]:focus {
            border-color: #f59e0b;
            ring-color: #f59e0b;
        }
        .gemini-response h3 {
            font-size: 1.125rem;
            font-weight: 600;
            margin-top: 1rem;
            margin-bottom: 0.5rem;
            color: #f59e0b;
        }
        .gemini-response ul {
            list-style-position: inside;
            padding-left: 0.5rem;
        }
        .gemini-response li {
            margin-bottom: 0.5rem;
        }
        .gemini-response p {
            margin-bottom: 0.75rem;
        }
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.1);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border-left-color: #f59e0b;
            animation: spin 1s ease infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        #stockpileCanvas {
            width: 100%;
            height: auto;
            max-width: 250px;
        }
    </style>
</head>
<body class="min-h-screen p-4 sm:p-6 lg:p-8">
    <div class="max-w-7xl mx-auto">
        <header class="text-center mb-10">
            <h1 class="text-4xl sm:text-5xl font-bold text-white">Dashboard de An√°lise de Baga√ßo</h1>
            <p class="mt-3 text-lg text-gray-400">Otimize o consumo de combust√≠vel e preveja seu estoque com IA.</p>
        </header>

        <main class="space-y-8">
            <section class="card p-6 lg:p-8">
                <h2 class="text-2xl font-bold mb-6 text-white flex items-center"><span class="text-amber-400 mr-3">‚öôÔ∏è</span>Painel de Controlo</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                    <div class="md:col-span-2 grid grid-cols-1 sm:grid-cols-2 gap-x-8 gap-y-6">
                        <div class="sm:col-span-2">
                            <h3 class="font-semibold text-lg text-gray-300 border-b border-gray-700 pb-2 mb-4">Par√¢metros da Caldeira e Baga√ßo</h3>
                        </div>
                        <div>
                            <label for="vaporSlider" class="block text-sm font-medium text-gray-400">Produ√ß√£o de Vapor (t/h)</label>
                            <span id="vaporValue" class="text-2xl font-semibold text-amber-400">250</span>
                            <input id="vaporSlider" type="range" min="50" max="500" value="250" step="10" class="w-full cursor-pointer slider">
                        </div>
                        <div>
                            <label for="eficienciaSlider" class="block text-sm font-medium text-gray-400">Efici√™ncia da Caldeira (%)</label>
                            <span id="eficienciaValue" class="text-2xl font-semibold text-amber-400">85</span>
                            <input id="eficienciaSlider" type="range" min="70" max="95" value="85" step="0.5" class="w-full cursor-pointer slider">
                        </div>
                         <div>
                            <label for="umidadeSlider" class="block text-sm font-medium text-gray-400">Umidade do Baga√ßo (%)</label>
                            <span id="umidadeValue" class="text-2xl font-semibold text-amber-400">55</span>
                            <input id="umidadeSlider" type="range" min="40" max="65" value="55" step="0.5" class="w-full cursor-pointer slider">
                        </div>
                         <div>
                            <label for="fibraSlider" class="block text-sm font-medium text-gray-400">Fibra do Baga√ßo (%)</label>
                            <span id="fibraValue" class="text-2xl font-semibold text-amber-400">25</span>
                            <input id="fibraSlider" type="range" min="0" max="50" value="25" step="0.5" class="w-full cursor-pointer slider">
                        </div>
                         <div class="sm:col-span-2">
                             <label for="temperaturaSlider" class="block text-sm font-medium text-gray-400">Temperatura do Vapor (¬∞C)</label>
                            <span id="temperaturaValue" class="text-2xl font-semibold text-amber-400">520</span>
                            <input id="temperaturaSlider" type="range" min="480" max="550" value="520" class="w-full cursor-pointer slider">
                        </div>
                        <div class="sm:col-span-2">
                            <h3 class="font-semibold text-lg text-gray-300 border-b border-gray-700 pb-2 mb-4 mt-4">Gest√£o de Estoque</h3>
                        </div>
                        <div>
                            <label for="estoqueInicialInput" class="block text-sm font-medium text-gray-400">Estoque Inicial (toneladas)</label>
                            <input id="estoqueInicialInput" type="number" value="81000" class="mt-1 w-full p-2 rounded-md shadow-sm focus:border-amber-500 focus:ring focus:ring-amber-500 focus:ring-opacity-50">
                        </div>
                        <div>
                            <label for="producaoDiariaInput" class="block text-sm font-medium text-gray-400">Produ√ß√£o Di√°ria (toneladas/dia)</label>
                             <input id="producaoDiariaInput" type="number" value="5200" class="mt-1 w-full p-2 rounded-md shadow-sm focus:border-amber-500 focus:ring focus:ring-amber-500 focus:ring-opacity-50">
                        </div>
                    </div>
                    
                    <div class="flex flex-col justify-center items-center p-6 rounded-lg result-card space-y-4 text-center border border-gray-700">
                        <h2 class="text-lg font-semibold text-gray-300">Consumo de Baga√ßo</h2>
                        <div>
                            <span id="consumoResult" class="text-6xl font-bold text-white">0.00</span>
                            <span class="text-xl font-medium text-gray-400">t/h</span>
                        </div>
                        <div class="text-center">
                             <p class="text-base text-gray-400">Consumo 24h: <span id="consumo24hResult" class="font-bold text-gray-200">0.00</span> t</p>
                        </div>
                        <div class="w-full grid grid-cols-2 gap-4 text-sm pt-4">
                            <div class="p-3 bg-gray-800/50 rounded-lg">
                                <p class="font-medium text-gray-400">PCI do Baga√ßo</p>
                                <p id="pciResult" class="font-bold text-xl text-white">0</p>
                                <p class="text-xs text-gray-500">kcal/kg</p>
                            </div>
                            <div class="p-3 bg-gray-800/50 rounded-lg">
                                <p class="font-medium text-gray-400">Energia Gerada</p>
                                <p id="energiaResult" class="font-bold text-xl text-white">0</p>
                                <p class="text-xs text-gray-500">Gcal/h</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            
            <section class="card p-6 lg:p-8">
                 <h2 class="text-2xl font-bold text-center mb-6 text-white flex items-center justify-center"><span class="text-amber-400 mr-3">üì¶</span>Previs√£o de Estoque</h2>
                 <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center mb-8">
                    <div class="flex flex-col items-center justify-center">
                        <h3 class="text-lg font-semibold text-gray-300 mb-2">N√≠vel do Estoque Atual</h3>
                        <div class="w-full max-w-[250px]">
                            <canvas id="stockpileCanvas" width="250" height="200"></canvas>
                        </div>
                        <p id="stockpilePercentage" class="mt-2 text-xl font-bold text-white"></p>
                    </div>
                    <div class="text-center p-6 h-full flex flex-col justify-center result-card rounded-lg border border-gray-700">
                        <h3 class="text-lg font-semibold text-gray-300">Autonomia do Estoque</h3>
                        <p id="tempoEstoqueResult" class="text-5xl font-bold text-white mt-2">Calculando...</p>
                    </div>
                 </div>
                <div class="chart-container">
                    <canvas id="estoqueChart"></canvas>
                </div>
            </section>

            <section class="card p-6 lg:p-8">
                <h2 class="text-2xl font-bold text-center mb-2 text-white flex items-center justify-center"><span class="text-amber-400 mr-3">üß†</span>An√°lise com IA</h2>
                <p class="text-base text-gray-400 mb-6 max-w-4xl mx-auto text-center">
                    Obtenha insights e recomenda√ß√µes personalizadas com base nos seus dados. Clique no bot√£o para gerar um relat√≥rio de otimiza√ß√£o instant√¢neo.
                </p>
                <div class="text-center mb-6">
                    <button id="gemini-button" class="bg-amber-500 text-gray-900 font-bold py-3 px-8 rounded-lg hover:bg-amber-400 transition-all shadow-lg shadow-amber-500/10 disabled:bg-gray-600 disabled:cursor-not-allowed">
                        ‚ú® Gerar An√°lise e Recomenda√ß√µes
                    </button>
                </div>
                <div id="gemini-response-container" class="mt-4 p-6 rounded-lg bg-gray-900/50 min-h-[100px] border border-gray-700">
                    <p class="text-center text-gray-500">A sua an√°lise aparecer√° aqui...</p>
                </div>
            </section>
            
            <section class="card p-6 lg:p-8">
                 <h2 class="text-2xl font-bold text-center mb-2 text-white flex items-center justify-center"><span class="text-amber-400 mr-3">üíß</span>Impacto da Umidade no Consumo</h2>
                 <p class="text-base text-gray-400 mb-6 max-w-4xl mx-auto text-center">
                    Este gr√°fico ilustra a rela√ß√£o direta entre a umidade do baga√ßo e o consumo de combust√≠vel, atualizando-se dinamicamente com os seus par√¢metros.
                </p>
                <div class="chart-container">
                    <canvas id="umidadeChart"></canvas>
                </div>
            </section>
            
            <footer class="text-center text-sm text-gray-500 pt-4 pb-4">
                 <p class="font-semibold mb-2 text-gray-400">Metodologia de C√°lculo</p>
                 <p><strong>PCI (Poder Calor√≠fico Inferior):</strong> (4400 + (Fibra% - 48) * 10) - (51 * %Umidade). <strong>Entalpia:</strong> Calculada para vapor superaquecido a 92 bar. <strong>Consumo:</strong> (Produ√ß√£o de Vapor * Ganho de Entalpia) / (PCI * Efici√™ncia).</p>
                 <p class="mt-4">&copy; 2025 Ferramenta de An√°lise Energ√©tica. Todos os direitos reservados.</p>
            </footer>
        </main>
    </div>

    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js').then(registration => {
                    console.log('ServiceWorker registration successful with scope: ', registration.scope);
                }, err => {
                    console.log('ServiceWorker registration failed: ', err);
                });
            });
        }

        document.addEventListener('DOMContentLoaded', () => {
            const vaporSlider = document.getElementById('vaporSlider');
            const umidadeSlider = document.getElementById('umidadeSlider');
            const eficienciaSlider = document.getElementById('eficienciaSlider');
            const temperaturaSlider = document.getElementById('temperaturaSlider');
            const fibraSlider = document.getElementById('fibraSlider');
            const estoqueInicialInput = document.getElementById('estoqueInicialInput');
            const producaoDiariaInput = document.getElementById('producaoDiariaInput');
            const vaporValue = document.getElementById('vaporValue');
            const umidadeValue = document.getElementById('umidadeValue');
            const eficienciaValue = document.getElementById('eficienciaValue');
            const temperaturaValue = document.getElementById('temperaturaValue');
            const fibraValue = document.getElementById('fibraValue');
            const consumoResult = document.getElementById('consumoResult');
            const consumo24hResult = document.getElementById('consumo24hResult');
            const pciResult = document.getElementById('pciResult');
            const energiaResult = document.getElementById('energiaResult');
            const tempoEstoqueResult = document.getElementById('tempoEstoqueResult');
            const geminiButton = document.getElementById('gemini-button');
            const geminiResponseContainer = document.getElementById('gemini-response-container');
            
            const stockpileCanvas = document.getElementById('stockpileCanvas');
            const stockpileCtx = stockpileCanvas.getContext('2d');
            const stockpilePercentageLabel = document.getElementById('stockpilePercentage');

            let umidadeChart, estoqueChart;
            const inputs = [vaporSlider, umidadeSlider, eficienciaSlider, temperaturaSlider, fibraSlider, estoqueInicialInput, producaoDiariaInput];
            const textColor = '#e5e7eb';
            const gridColor = 'rgba(255, 255, 255, 0.1)';
            const accentColor = '#f59e0b';
            const accentColorTransparent = 'rgba(245, 158, 11, 0.1)';

            const MAX_VISUAL_STOCK = 150000;

            function drawStockpile(percentage) {
                const w = stockpileCanvas.width;
                const h = stockpileCanvas.height;
                stockpileCtx.clearRect(0, 0, w, h);

                const baseY = h * 0.95;

                stockpileCtx.strokeStyle = '#4b5563';
                stockpileCtx.lineWidth = 2;
                stockpileCtx.beginPath();
                stockpileCtx.moveTo(0, baseY);
                stockpileCtx.lineTo(w, baseY);
                stockpileCtx.stroke();
                
                if (percentage > 0) {
                    const pileHeight = (h * 0.9) * Math.max(0.01, percentage);
                    const topY = baseY - pileHeight;

                    const gradient = stockpileCtx.createLinearGradient(0, topY, 0, baseY);
                    gradient.addColorStop(0, '#f59e0b');
                    gradient.addColorStop(1, '#b45309');

                    stockpileCtx.fillStyle = gradient;
                    
                    stockpileCtx.beginPath();
                    stockpileCtx.moveTo(0, baseY);

                    stockpileCtx.quadraticCurveTo(w * 0.1, baseY - pileHeight * 0.5, w * 0.2, baseY - pileHeight * 0.4);
                    stockpileCtx.quadraticCurveTo(w * 0.35, topY, w * 0.5, baseY - pileHeight * 0.7);
                    stockpileCtx.quadraticCurveTo(w * 0.6, topY - pileHeight * 0.2, w * 0.75, topY);
                    stockpileCtx.quadraticCurveTo(w * 0.9, baseY - pileHeight * 0.6, w, baseY);
                    
                    stockpileCtx.closePath();
                    stockpileCtx.fill();
                }
            }


            function getSteamEnthalpy(temp) {
                const baseTemp = 520;
                const baseEnthalpy = 3445;
                const tempCorrection = (temp - baseTemp) * 0.5;
                return baseEnthalpy + tempCorrection;
            }

            function calculateAndDisplay() {
                const vapor = parseFloat(vaporSlider.value);
                const umidade = parseFloat(umidadeSlider.value);
                const eficiencia = parseFloat(eficienciaSlider.value) / 100;
                const temperatura = parseFloat(temperaturaSlider.value);
                const fibra = parseFloat(fibraSlider.value);
                const estoqueInicial = parseFloat(estoqueInicialInput.value) || 0;
                const producaoDiaria = parseFloat(producaoDiariaInput.value) || 0;
                vaporValue.textContent = vapor.toFixed(0);
                umidadeValue.textContent = umidade.toFixed(1);
                eficienciaValue.textContent = (eficiencia * 100).toFixed(1);
                temperaturaValue.textContent = temperatura.toFixed(0);
                fibraValue.textContent = fibra.toFixed(1);
                const pciBaseSeco = 4400 + (fibra - 48) * 10;
                const pci = pciBaseSeco - (51 * umidade);
                const entalpiaVaporKJ = getSteamEnthalpy(temperatura);
                const entalpiaAguaKJ = 419;
                const deltaEntalpiaKJ = entalpiaVaporKJ - entalpiaAguaKJ;
                const KJ_TO_KCAL = 0.239006;
                const deltaEntalpiaKcal = deltaEntalpiaKJ * KJ_TO_KCAL;
                const vaporKgH = vapor * 1000;
                const energiaUtilKcalH = vaporKgH * deltaEntalpiaKcal;
                const energiaTotalKcalH = energiaUtilKcalH / eficiencia;
                const consumoKgH = energiaTotalKcalH / pci;
                const consumoTonH = consumoKgH / 1000;
                const consumo24h = consumoTonH * 24;
                consumoResult.textContent = isNaN(consumoTonH) ? '0.00' : consumoTonH.toFixed(2);
                consumo24hResult.textContent = isNaN(consumo24h) ? '0.00' : consumo24h.toFixed(2);
                pciResult.textContent = isNaN(pci) ? '0' : pci.toFixed(0);
                energiaResult.textContent = isNaN(energiaUtilKcalH) ? '0' : (energiaUtilKcalH / 1_000_000).toFixed(2);
                const saldoDiario = producaoDiaria - consumo24h;
                if (saldoDiario >= 0) {
                    tempoEstoqueResult.textContent = 'Sustent√°vel';
                } else if (estoqueInicial <= 0) {
                    tempoEstoqueResult.textContent = 'Sem Estoque';
                } else {
                    const diasParaAcabar = estoqueInicial / Math.abs(saldoDiario);
                    const dias = Math.floor(diasParaAcabar);
                    const horas = Math.round((diasParaAcabar - dias) * 24);
                    tempoEstoqueResult.textContent = `${dias} dias e ${horas}h`;
                }

                const stockPercentage = Math.min(1, estoqueInicial / MAX_VISUAL_STOCK);
                drawStockpile(stockPercentage);
                stockpilePercentageLabel.textContent = `${(stockPercentage * 100).toFixed(1)}% da capacidade;
                
                updateUmidadeChartData();
                updateEstoqueChartData();
            }

            function updateUmidadeChartData() {
                const vapor = parseFloat(vaporSlider.value);
                const eficiencia = parseFloat(eficienciaSlider.value) / 100;
                const temperatura = parseFloat(temperaturaSlider.value);
                const fibra = parseFloat(fibraSlider.value);
                const entalpiaVaporKJ = getSteamEnthalpy(temperatura);
                const entalpiaAguaKJ = 419;
                const deltaEntalpiaKJ = entalpiaVaporKJ - entalpiaAguaKJ;
                const KJ_TO_KCAL = 0.239006;
                const deltaEntalpiaKcal = deltaEntalpiaKJ * KJ_TO_KCAL;
                const vaporKgH = vapor * 1000;
                const energiaUtilKcalH = vaporKgH * deltaEntalpiaKcal;
                const energiaTotalKcalH = energiaUtilKcalH / eficiencia;
                const pciBaseSeco = 4400 + (fibra - 48) * 10;
                const labels = [];
                const data = [];
                for (let u = 40; u <= 65; u += 1) {
                    labels.push(u);
                    const pci = pciBaseSeco - (51 * u);
                    const consumo = (energiaTotalKcalH / pci) / 1000;
                    data.push(consumo);
                }
                umidadeChart.data.labels = labels;
                umidadeChart.data.datasets[0].data = data;
                umidadeChart.update();
            }

            function updateEstoqueChartData() {
                const estoqueInicial = parseFloat(estoqueInicialInput.value) || 0;
                const producaoDiaria = parseFloat(producaoDiariaInput.value) || 0;
                const consumo24h = parseFloat(consumo24hResult.textContent) || 0;
                const saldoDiario = producaoDiaria - consumo24h;
                const labels = [];
                const data = [];
                for (let i = 0; i <= 30; i++) {
                    labels.push(`Dia ${i}`);
                    const estoqueAtual = estoqueInicial + (saldoDiario * i);
                    data.push(Math.max(0, estoqueAtual));
                }
                estoqueChart.data.labels = labels;
                estoqueChart.data.datasets[0].data = data;
                estoqueChart.update();
            }

            function createUmidadeChart() {
                const ctx = document.getElementById('umidadeChart').getContext('2d');
                umidadeChart = new Chart(ctx, {
                    type: 'line',
                    data: { labels: [], datasets: [{ label: 'Consumo de Baga√ßo (t/h)', data: [], borderColor: accentColor, backgroundColor: accentColorTransparent, borderWidth: 3, fill: true, tension: 0.4 }] },
                    options: { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: false, title: { display: true, text: 'Consumo (t/h)', color: textColor }, ticks: { color: textColor }, grid: { color: gridColor } }, x: { title: { display: true, text: 'Umidade do Baga√ßo (%)', color: textColor }, ticks: { color: textColor }, grid: { color: gridColor } } }, plugins: { tooltip: { mode: 'index', intersect: false }, legend: { display: false } }, interaction: { mode: 'nearest', axis: 'x', intersect: false } }
                });
            }

            function createEstoqueChart() {
                const ctx = document.getElementById('estoqueChart').getContext('2d');
                estoqueChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: [],
                        datasets: [{ label: 'Proje√ß√£o de Estoque (t)', data: [], borderColor: accentColor, backgroundColor: accentColorTransparent, borderWidth: 3, fill: true, tension: 0.1 }]
                    },
                    options: { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: true, title: { display: true, text: 'Estoque (toneladas)', color: textColor }, ticks: { color: textColor }, grid: { color: gridColor } }, x: { title: { display: true, text: 'Proje√ß√£o para os Pr√≥ximos 30 Dias', color: textColor }, ticks: { color: textColor }, grid: { color: gridColor } } }, plugins: { legend: { display: false }, tooltip: { callbacks: { label: function(context) { return `${context.dataset.label}: ${context.parsed.y.toFixed(2)} t`; } } } } }
                });
            }

            function markdownToHtml(md) {
                return md
                    .replace(/^### (.*$)/gim, '<h3 class="text-amber-400">$1</h3>')
                    .replace(/^## (.*$)/gim, '<h3 class="text-amber-400">$1</h3>')
                    .replace(/^# (.*$)/gim, '<h3 class="text-amber-400">$1</h3>')
                    .replace(/^\* (.*$)/gim, '<ul><li class="relative pl-5 before:content-[\'‚Üí\'] before:absolute before:left-0 before:text-amber-400">$1</li></ul>')
                    .replace(/<\/ul><ul>/gim, '')
                    .replace(/\*\*(.*)\*\*/gim, '<strong class="text-white">$1</strong>')
                    .replace(/\n/g, '<br>');
            }

            async function callGeminiApi() {
                geminiButton.disabled = true;
                geminiResponseContainer.innerHTML = '<div class="flex justify-center items-center"><div class="spinner"></div><p class="ml-4 text-gray-400">A analisar os dados...</p></div>';
                
                const data = {
                    vapor: vaporValue.textContent,
                    umidade: umidadeValue.textContent,
                    eficiencia: eficienciaValue.textContent,
                    fibra: fibraValue.textContent,
                    estoque: estoqueInicialInput.value,
                    producaoDiaria: producaoDiariaInput.value,
                    consumoDiario: consumo24hResult.textContent,
                    previsao: tempoEstoqueResult.textContent
                };

                const systemPrompt = "Voc√™ √© um especialista em efici√™ncia de caldeiras industriais e energia de biomassa, com foco em baga√ßo de cana. A sua tarefa √© analisar os dados operacionais fornecidos e gerar um relat√≥rio conciso com uma an√°lise da situa√ß√£o atual e recomenda√ß√µes pr√°ticas e acion√°veis para otimiza√ß√£o. Responda em portugu√™s do Brasil.";
                
                const userQuery = `Analise os seguintes dados operacionais de uma caldeira a baga√ßo e forne√ßa insights e recomenda√ß√µes. ## Dados Atuais * Produ√ß√£o de Vapor: ${data.vapor} t/h * Umidade do Baga√ßo: ${data.umidade}% * Fibra do Baga√ßo: ${data.fibra}% * Efici√™ncia da Caldeira: ${data.eficiencia}% * Estoque Inicial: ${data.estoque} toneladas * Produ√ß√£o Di√°ria de Baga√ßo: ${data.producaoDiaria} t/dia * Consumo Di√°rio de Baga√ßo: ${data.consumoDiario} t/dia * Previs√£o de Estoque: ${data.previsao} Com base nesses dados, forne√ßa: 1. Uma breve an√°lise da situa√ß√£o atual do consumo e do estoque, considerando o impacto da fibra. 2. Pelo menos tr√™s recomenda√ß√µes claras e pr√°ticas para otimizar o consumo de combust√≠vel, melhorar a efici√™ncia ou gerir melhor o estoque. Foque nos pontos mais cr√≠ticos (ex: alta umidade, baixa fibra, etc). 3. Formate a resposta em markdown, usando t√≠tulos e listas.`;

                const apiKey = "";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

                const payload = {
                    contents: [{ parts: [{ text: userQuery }] }],
                    systemInstruction: { parts: [{ text: systemPrompt }] },
                };

                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    if (!response.ok) { throw new Error(`HTTP error! status: ${response.status}`); }
                    const result = await response.json();
                    const candidate = result.candidates?.[0];
                    if (candidate && candidate.content?.parts?.[0]?.text) {
                        const text = candidate.content.parts[0].text;
                        geminiResponseContainer.innerHTML = markdownToHtml(text);
                        geminiResponseContainer.classList.add("gemini-response");
                    } else { throw new Error("Resposta da API inv√°lida."); }
                } catch (error) {
                    console.error("Erro ao chamar a API Gemini:", error);
                    geminiResponseContainer.innerHTML = '<p class="text-red-500 text-center">Ocorreu um erro ao gerar a an√°lise. Por favor, tente novamente.</p>';
                } finally {
                    geminiButton.disabled = false;
                }
            }
            
            geminiButton.addEventListener('click', callGeminiApi);
            createUmidadeChart();
            createEstoqueChart();
            calculateAndDisplay();
            inputs.forEach(input => {
                input.addEventListener('input', calculateAndDisplay);
            });
        });
    </script>
</body>
</html>

